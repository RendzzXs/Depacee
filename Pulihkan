#!/bin/bash

echo "ğŸš¨ Memulai proses pemulihan Pterodactyl..."

PTERO_DIR="/var/www/pterodactyl"
BACKUP_DIR="/var/www/pterodactyl_backup_$(date +%F_%T)"

echo "ğŸ“¦ Backup file lama ke $BACKUP_DIR"
cp -r $PTERO_DIR $BACKUP_DIR

echo "ğŸ—‘ï¸ Menghapus file panel lama..."
rm -rf $PTERO_DIR/*

echo "â¬‡ï¸ Download ulang Pterodactyl terbaru..."
cd /var/www
curl -Lo panel.tar.gz https://github.com/pterodactyl/panel/releases/latest/download/panel.tar.gz
mkdir -p $PTERO_DIR
tar -xzvf panel.tar.gz -C $PTERO_DIR
rm panel.tar.gz

cd $PTERO_DIR

echo "ğŸ“‚ Set permission..."
chmod -R 755 storage/* bootstrap/cache
chown -R www-data:www-data *

echo "ğŸ“¦ Install dependency..."
curl -sS https://getcomposer.org/installer | php
php composer.phar install --no-dev --optimize-autoloader

echo "ğŸ”„ Cache config..."
php artisan config:clear
php artisan cache:clear
php artisan view:clear

echo "âœ… Selesai! Silakan restart nginx / apache"

echo "ğŸ’¡ Jangan lupa cek file .env dan pastikan tidak berubah"
